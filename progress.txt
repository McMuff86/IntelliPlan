# IntelliPlan - Ralph Progress Log

## Codebase Patterns
<!-- Add reusable patterns here as they are discovered -->
<!-- Example: Use `sql<number>` template for aggregations -->
<!-- Example: Always use `IF NOT EXISTS` for migrations -->

---

## Iteration Log
<!-- Each Ralph iteration appends its progress below -->
  
## 2026-01-13 - US-001  
Thread: https://ampcode.com/threads/T-019bb959-ef98-70d3-8968-161c39a15ead  
- Backend: Node.js/Express with TypeScript initialized  
- Frontend: React with Vite, Material-UI, TypeScript initialized  
- Database: PostgreSQL migrations created (teams, users, appointments)  
- Migration runner at npm run migrate  
  
**Files created:**  
- backend/ - Full Express API structure  
- frontend/ - Full React app structure  
- backend/migrations/ - SQL migration files  
  
**Learnings for future iterations:**  
- Use IF NOT EXISTS for all CREATE TABLE/INDEX statements  
- Vite requires type-only imports (import type) for verbatimModuleSyntax  
- ESLint v9 requires flat config but we used legacy .eslintrc.json  
--- 
  
## 2026-01-14 - US-002  
Thread: https://ampcode.com/threads/T-019bb959-ef98-70d3-8968-161c39a15ead  
- POST /api/appointments endpoint created  
- Validates title, startTime, endTime with express-validator  
- Returns 201 with created appointment  
- Returns 400 with validation errors  
  
**Files created:**  
- models/appointment.ts - Types and response mapper  
- services/appointmentService.ts - Database operations  
- controllers/appointmentController.ts - Request handling  
- validators/appointmentValidator.ts - Input validation  
- routes/appointments.ts - Route definitions  
  
**Learnings:**  
- Use camelCase in API (startTime) but snake_case in DB (start_time)  
- toAppointmentResponse() maps between formats  
---

## 2026-01-14 - US-003
Thread: https://ampcode.com/threads/T-019bbad3-bf06-7019-a96f-5be88384398f
- GET /api/appointments endpoint with pagination (limit, offset)
- GET /api/appointments/:id endpoint for single appointment
- Date range filtering via ?start=&end= query params
- 404 response for non-existent appointments
- User ownership enforced (users only see their own)

**Files modified:**
- services/appointmentService.ts - Added getAppointments() and getAppointmentById()
- controllers/appointmentController.ts - Added list() and getById() handlers
- routes/appointments.ts - Added GET routes

**Learnings:**
- req.params.id can be string | string[] in Express types - use `as string` assertion
- req.headers values can be string | string[] - handle array case with ternary
---

## 2026-01-14 - US-004
Thread: https://ampcode.com/threads/T-019bbb04-2438-7386-97cc-7c73c53fc01a
- PUT /api/appointments/:id endpoint created
- Validates ownership before update (returns 403 if not owner)
- Partial updates supported (only provided fields are updated)
- Returns 200 with updated appointment, 404 if not found, 403 if unauthorized

**Files modified:**
- models/appointment.ts - Added UpdateAppointmentDTO interface
- services/appointmentService.ts - Added getAppointmentOwner() and updateAppointment()
- controllers/appointmentController.ts - Added update() handler
- validators/appointmentValidator.ts - Added updateAppointmentValidator (all fields optional)
- routes/appointments.ts - Added PUT /:id route

**Learnings:**
- For partial updates, build SQL SET clause dynamically with parameterized index
- Check ownership separately from fetching appointment to return proper 403 vs 404
- ValidationChain type import needed for explicit validator array typing
---

## 2026-01-14 - US-005
Thread: https://ampcode.com/threads/T-019bbb0d-33d6-75bb-84b7-fcc0b79edc4d
- DELETE /api/appointments/:id endpoint created
- Validates ownership before deletion (403 if not owner)
- Returns 204 on successful deletion
- Returns 404 for non-existent appointments
- Implements soft delete (sets deleted_at timestamp)

**Files modified:**
- services/appointmentService.ts - Added deleteAppointment() function
- controllers/appointmentController.ts - Added remove() handler
- routes/appointments.ts - Added DELETE /:id route

**Learnings:**
- Soft delete pattern: UPDATE SET deleted_at = NOW() instead of DELETE
- All queries already filter with deleted_at IS NULL for consistency
---
